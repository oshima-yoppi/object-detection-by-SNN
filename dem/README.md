
# イベントカメラとスパイキングニューラルネットワークによる月面の障害物検知

月面クレータをイベントカメラ使って検知したい。  
1. シミュレーション上で月面DEMを生成
2. Blenderで月面DEMをプロットし、アニメーションを行う。そしてカメラが月面に近づいていく様子の動画を作成する
3. V2Eを用いて動画からイベントデータに変換する。
4. 学習を行う

# DEMO

## フォルダ説明
- `akida`：brainchip関連。無視してよい
- `blender`：blender関連。
- `dataset`：データセット関連。シミュレーションによって作成されたデータが保存されていく。
- `dataset_ann`：データセット関連。イベントデータではなく、画像が保存されてる。SNNじゃなくてANNを学習させたいときに使用する。
- `dataset_boulder`：データセット関連。イベントデータが保存されてる。障害物にクレータを含ませず、ボルダーのみで学習させたいときに使用する。(正直あまり意味ない)
- `DEM`：DEM関連。MATLABでDEMを生成するときに使用する。実際には使っていない。DEM生成はPythonで行った。
- `label_only`：データセット関連。ラベルのみが保存されている。
- `label_only_boulder`：データセット関連。障害物にクレータを含まないときに使用。ラベルのみが保存されている。(正直意味ない)
- `models`：学習済みモデルが保存されている。
‐ `modules`：モジュール関連。モジュールをまとめている。かなり重要フォルダ。このフォルダ内で多くの関数や重要定数を定義している。
- `raw-data`：V2Eで変換したそのままのイベントデータが保存されている。(実際、SNNにこの生データを入力しない。時間窓に区切って入力する。)
- `result_img`：学習結果の画像が保存されている。
‐ `result_img_boulder`：学習結果の画像が保存されている。障害物にクレータを含まないときに使用する。(正直意味ない)


# ファイル説明
1. DEM生成  
    - `create_dem.py`：DEMを生成する。フラクタルモデリングによって生成。クレータやボルダーの生成方法は[論文”障害物検知評価のための高精細模擬月面地形のモデリング手法”](https://www.jsass.jp/conference/sstc62.php#:~:text=%E9%9A%9C%E5%AE%B3%E7%89%A9%E6%A4%9C%E7%9F%A5%E8%A9%95%E4%BE%A1%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E9%AB%98%E7%B2%BE%E7%B4%B0%E6%A8%A1%E6%93%AC%E6%9C%88%E9%9D%A2%E5%9C%B0%E5%BD%A2%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0%E6%89%8B%E6%B3%95)を参考にした。クレータ生成と同時に安全危険領域のマッピングも行う。
2. Blender
    - `blender/train.blend`によってアニメーションを作成し、動画を保存する。
        - blender内部で`blender_make_video.py`のファイルを開き、スクリプト実行する。
3. V2E
    - `create_dataset.py`によって動画からイベントデータに変換する。
4. 学習
    - `train.py`：学習開始
3. 解析
    - `analysis.ipynb`：学習結果を解析
4. その他ファイル説明
    - `akida-dataset.py`：brainchipのデータセットを作成するために使用。無視してよい
    - `model.py`：モデル定義
    ‐ `data.py`: データローダー定義
    - `openh5.py`: h5ファイルの中身を確認＆`youtube`フォルダ内に動画を保存する
    - `blender_make_video.py`：blenderでアニメーションをするためのファイル。設定関連も行ってくれる。blender内部で開く。blender上で実行。
    - `fractal`：フラクタルモデリングするための関数ファイル・
    - `show_dem`：作成されたDEMをプロットするための関数ファイル。確認用。
    - `show_img_pertial`：[本物の月面DEM](https://www.isas.jaxa.jp/home/showcase/xR/kaguya-dem.html.ja)を確認するためファイル。実際の生データを表示させようとするとメモリえーらが発生するので、一部のみ表示する。
    - `train_ann`：ANNを用いて学習を行うためのファイル。SNNではない。
    - `train_change_time`：推論の時間（timespte数）を変更できるファイル。
    - `train_spike`：消費電量をさげるため、損失関数にスパイクの本数を導入した学習方法。SNNでいつも通り学習した後、このファイルで転移学習をすることにより、精度を保ちつつ消費電量kを下げることができる。

